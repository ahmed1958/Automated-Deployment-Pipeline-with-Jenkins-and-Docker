    pipeline {
        agent any
        environment {
            DOCKER_IMAGE = 'sekovv/countingapp'
        }
        stages {
            stage('Check Trigger') {
                steps {
                    script {
                        if (env.GIT_PREVIOUS_SUCCESSFUL_COMMIT) {
                            echo "Triggered by GitHub webhook."
                        } else {
                            echo "Pipeline not triggered by a GitHub webhook."
                        }
                    }
                }
            }

            stage('Clone Repo') {
            steps {
                git branch: 'main', url: 'https://github.com/ahmed1958/Automated-Deployment-Pipeline-with-Jenkins-and-Docker'
            }
            }
           stage('Build Image') {
            steps {
                script {
                    docker.build(DOCKER_IMAGE, 'counting_App')
                }
            }
           }

            stage('Push Image') {
            steps {
                script {
                    // Use the correct registry URL
                    docker.withRegistry('https://index.docker.io/v1/', 'docker_hub_log') {
                        // Ensure that DOCKER_IMAGE includes the tag
                        docker.image(DOCKER_IMAGE).push() // Specify a tag if needed
                    }
                }
            }
            }
   
    }
}
